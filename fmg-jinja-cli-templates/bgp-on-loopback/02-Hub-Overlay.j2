{% import 'Project' as project with context %}

{% for i in project.profiles[profile].interfaces if i.role == 'wan' %}
config vpn ipsec phase1-interface
  edit "EDGE_{{ i.ol_type }}"
    set type dynamic
    set interface "{{ i.name }}"
    set ike-version 2
    set authmethod signature
    set peertype any
    set proposal aes256-sha256
    set add-route disable
    set auto-discovery-sender enable
    set exchange-ip-addr4 {{ loopback }}
    set network-overlay enable
    set network-id {{ project.hubs[hostname].overlays[i.ol_type].network_id }}
    set certificate "{{ project.edge_cert_template|default('Hub') }}"
    set dpd-retrycount 2
    set dpd-retryinterval 5
    set dpd on-idle
  next
end
config vpn ipsec phase2-interface
  edit "EDGE_{{ i.ol_type }}"
    set phase1name "EDGE_{{ i.ol_type }}"
    set proposal aes256-sha256
    set keepalive enable
  next
end
{% endfor %}
